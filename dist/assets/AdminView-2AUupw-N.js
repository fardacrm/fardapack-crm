import{_ as x,r as u,c as r,d as e,t as w,m as g,w as C,p as S,l as n,f as N,a as v,k,o as O,b as R,q as z,F as j,h as E,e as J,S as G,u as H,g as K}from"./index-DNgNiQ0R.js";const Q={class:"modal-box"},W={class:"input-group-full"},X={__name:"PasswordFormModal",props:{username:{type:String,required:!0}},emits:["close","save"],setup(U,{emit:f}){const b=f,c=u(""),p=()=>{b("close")},t=()=>{b("save",c.value)};return(d,i)=>(n(),r("div",{class:"modal-overlay",onClick:g(p,["self"])},[e("div",Q,[e("h2",null,"ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø±Ø§ÛŒ: "+w(U.username),1),e("form",{onSubmit:g(t,["prevent"])},[e("div",W,[i[1]||(i[1]=e("label",{for:"new_password"},"Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯ *",-1)),C(e("input",{id:"new_password","onUpdate:modelValue":i[0]||(i[0]=_=>c.value=_),type:"password",placeholder:"Ø­Ø¯Ø§Ù‚Ù„ 6 Ú©Ø§Ø±Ø§Ú©ØªØ±",required:""},null,512),[[S,c.value]])]),e("div",{class:"modal-actions"},[e("button",{type:"button",class:"btn-cancel",onClick:p},"Ù„ØºÙˆ"),i[2]||(i[2]=e("button",{type:"submit",class:"btn-save"},"Ø°Ø®ÛŒØ±Ù‡ Ø±Ù…Ø²",-1))])],32)])]))}},Y=x(X,[["__scopeId","data-v-0c9812ed"]]),Z={class:"modal-box"},ee={class:"input-group-full"},se={key:0,class:"loading-message"},ae={key:1,class:"success-message"},te={key:2,class:"error-detail"},le={class:"modal-actions"},oe=["disabled"],ne={__name:"RestoreBackupModal",emits:["close","restore-success"],setup(U,{emit:f}){const b=f,c=u(null),p=u(!1),t=u(null),d=u(null),i=y=>{c.value=y.target.files[0]},_=()=>{b("close")},m=async()=>{if(!c.value)return;p.value=!0,t.value=null,d.value=null;const y=new FormData;y.append("file",c.value);try{const o=await k.post("/admin/restore-db",y,{headers:{"Content-Type":"multipart/form-data"}});d.value=o.data.message+" Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.",b("restore-success")}catch(o){o.response&&o.response.data&&o.response.data.detail?t.value=o.response.data.detail:t.value="Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ."}finally{p.value=!1}};return(y,o)=>(n(),r("div",{class:"modal-overlay",onClick:g(_,["self"])},[e("div",Z,[o[1]||(o[1]=e("h2",null,"â™»ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ø¨Ú©Ø§Ù¾",-1)),o[2]||(o[2]=e("p",{class:"help-text"},[N(" ØªÙˆØ¬Ù‡: ÙØ§ÛŒÙ„ `.db` ÛŒØ§ `.zip` (Ø­Ø§ÙˆÛŒ ÙØ§ÛŒÙ„ `.db`) Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯. "),e("strong",null,"Ø§ÛŒÙ† Ø¹Ù…Ù„ØŒ ØªÙ…Ø§Ù… Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ (Overwrite) Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.")],-1)),e("form",{onSubmit:g(m,["prevent"])},[e("div",ee,[o[0]||(o[0]=e("label",{for:"backup_file"},"ÙØ§ÛŒÙ„ Ø¨Ú©Ø§Ù¾ (.db ÛŒØ§ .zip) *",-1)),e("input",{id:"backup_file",type:"file",onChange:i,accept:".db,.zip",required:"",class:"file-input"},null,32)]),p.value?(n(),r("div",se,"Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ... Ø§ÛŒÙ† ÙØ±Ø¢ÛŒÙ†Ø¯ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ú†Ù†Ø¯ Ø«Ø§Ù†ÛŒÙ‡ Ø·ÙˆÙ„ Ø¨Ú©Ø´Ø¯.")):v("",!0),d.value?(n(),r("div",ae,w(d.value),1)):v("",!0),t.value?(n(),r("div",te,w(t.value),1)):v("",!0),e("div",le,[e("button",{type:"button",class:"btn-cancel",onClick:_},"Ù„ØºÙˆ"),e("button",{type:"submit",class:"btn-save btn-danger",disabled:!c.value||p.value},w(p.value?"Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ...":"ØªØ§ÛŒÛŒØ¯ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ"),9,oe)])],32)])]))}},ue=x(ne,[["__scopeId","data-v-48a92a80"]]),re={class:"page-content"},de={key:0,class:"loading-message"},ie={key:0},ce={key:1,class:"error-detail"},pe={key:1},ve={class:"form-container"},me={key:0,class:"success-message"},fe={key:1,class:"error-detail"},be={key:0,class:"loading-message"},ye={key:1},we=["onClick"],_e=["onClick"],ke={__name:"AdminView",setup(U){const f=u(!1),b=u(!0),c=u(!0),p=u([]),t=u(null),d=u(!1),i=u(""),_=u(null),m=u({username:"",password:"",role:"agent"}),y=u(!1),o=u(null),V=l=>{o.value=l,y.value=!0},A=()=>{y.value=!1,o.value=null},$=u(!1),B=()=>{$.value=!0},D=()=>{$.value=!1},T=()=>{h()},F=async()=>{b.value=!0;try{const l=await k.get("/me");_.value=l.data,l.data.role==="admin"?(f.value=!0,await h()):f.value=!1}catch{f.value=!1,t.value="Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¬ÙˆØ² Ø¯Ø³ØªØ±Ø³ÛŒ."}finally{b.value=!1}},h=async()=>{c.value=!0;try{const l=await k.get("/admin/app-users");p.value=l.data}catch{t.value="Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†."}finally{c.value=!1}},q=async()=>{t.value=null,d.value=!1;try{const l=await k.post("/admin/app-users",m.value);i.value=l.data.message,d.value=!0,m.value={username:"",password:"",role:"agent"},h(),setTimeout(()=>{d.value=!1},3e3)}catch(l){l.response&&l.response.data&&l.response.data.detail?t.value=l.response.data.detail:t.value="Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±."}},P=async l=>{t.value=null,d.value=!1;try{const s=await k.put(`/admin/app-users/${o.value.id}/password`,{new_password:l});i.value=s.data.message,d.value=!0,A(),setTimeout(()=>{d.value=!1},3e3)}catch(s){s.response&&s.response.data&&s.response.data.detail?t.value=s.response.data.detail:t.value="Ø®Ø·Ø§ Ø¯Ø± ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±."}},I=async(l,s)=>{if(confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø± Â«${s}Â» Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.`)){t.value=null,d.value=!1;try{const a=await k.delete(`/admin/app-users/${l}`);i.value=a.data.message,d.value=!0,h(),setTimeout(()=>{d.value=!1},3e3)}catch(a){a.response&&a.response.data&&a.response.data.detail?t.value=a.response.data.detail:t.value="Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø±."}}},L=async()=>{t.value=null;try{const l=await k.get("/admin/backup-db",{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([l.data])),a=document.createElement("a");a.href=s;const M=new Date().toISOString().split("T")[0];a.setAttribute("download",`crm_backup_${M}.db`),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s)}catch{t.value="Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø¨Ú©Ø§Ù¾."}};return O(F),(l,s)=>(n(),r("div",re,[f.value?v("",!0):(n(),r("div",de,[b.value?(n(),r("p",ie,"Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¬ÙˆØ² Ø¯Ø³ØªØ±Ø³ÛŒ...")):(n(),r("p",ce,"Ø´Ù…Ø§ Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯."))])),f.value?(n(),r("div",pe,[s[9]||(s[9]=e("h2",null,"ğŸ”’ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø³ÛŒØ³ØªÙ…",-1)),e("div",ve,[s[5]||(s[5]=e("h3",null,"Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± ÙˆØ±ÙˆØ¯ Ø¬Ø¯ÛŒØ¯",-1)),e("form",{onSubmit:g(q,["prevent"]),class:"add-user-form"},[C(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>m.value.username=a),type:"text",placeholder:"Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¬Ø¯ÛŒØ¯",required:""},null,512),[[S,m.value.username]]),C(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>m.value.password=a),type:"password",placeholder:"Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±",required:""},null,512),[[S,m.value.password]]),C(e("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>m.value.role=a),required:""},[...s[3]||(s[3]=[e("option",{value:"agent"},"Ú©Ø§Ø±Ø´Ù†Ø§Ø³ ÙØ±ÙˆØ´",-1),e("option",{value:"admin"},"Ù…Ø¯ÛŒØ± (Admin)",-1)])],512),[[z,m.value.role]]),s[4]||(s[4]=e("button",{type:"submit",class:"add-new-button"},"Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±",-1))],32),d.value?(n(),r("div",me,w(i.value),1)):v("",!0),t.value?(n(),r("div",fe,w(t.value),1)):v("",!0)]),s[10]||(s[10]=e("h3",null,"Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ù„ÛŒ",-1)),c.value?(n(),r("div",be,"Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª...")):v("",!0),p.value.length>0?(n(),r("table",ye,[s[6]||(s[6]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ"),e("th",null,"Ù†Ù‚Ø´"),e("th",null,"ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯"),e("th",null,"Ø¹Ù…Ù„ÛŒØ§Øª")])],-1)),e("tbody",null,[(n(!0),r(j,null,E(p.value,a=>(n(),r("tr",{key:a.id},[e("td",null,w(a.id),1),e("td",null,w(a.username),1),e("td",null,[J(G,{text:a.role==="admin"?"Ù…Ø¯ÛŒØ±":"Ú©Ø§Ø±Ø´Ù†Ø§Ø³ ÙØ±ÙˆØ´"},null,8,["text"])]),e("td",null,w(H(K)(a.created_at)),1),e("td",null,[e("button",{onClick:M=>V(a),class:"btn-edit"},"ğŸ”‘ ØªØºÛŒÛŒØ± Ø±Ù…Ø²",8,we),a.id!==_.value.id?(n(),r("button",{key:0,onClick:M=>I(a.id,a.username),class:"btn-delete"}," ğŸ—‘ï¸ Ø­Ø°Ù ",8,_e)):v("",!0)])]))),128))])])):v("",!0),e("div",{class:"backup-section"},[s[7]||(s[7]=e("h2",null,"ğŸ›¡ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³",-1)),s[8]||(s[8]=e("p",null," Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÙØ¹Ù„ÛŒ ÙØ§ÛŒÙ„ Ø¨Ú©Ø§Ù¾ (crm.db) Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯ ÛŒØ§ ÛŒÚ© ÙØ§ÛŒÙ„ Ø¨Ú©Ø§Ù¾ Ù‚Ø¨Ù„ÛŒ Ø±Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†ÛŒØ¯. ",-1)),e("div",{class:"backup-actions"},[e("button",{onClick:L,class:"btn-download"}," â¬‡ï¸ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ú©Ø§Ù¾ ÙØ¹Ù„ÛŒ "),e("button",{onClick:B,class:"btn-restore"}," â™»ï¸ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ø¨Ú©Ø§Ù¾ ")])])])):v("",!0),y.value&&o.value?(n(),R(Y,{key:2,username:o.value.username,onClose:A,onSave:P},null,8,["username"])):v("",!0),$.value?(n(),R(ue,{key:3,onClose:D,onRestoreSuccess:T})):v("",!0)]))}},he=x(ke,[["__scopeId","data-v-09f8c005"]]);export{he as default};
